(function(d){var c="canvasResize",a={newsize:function(g,j,f,i,l){if(g==0&&j==0){return{width:f,height:i};}else{if((f&&g>f)||(i&&j>i)){var k=g/j;if((k>=1||i==0)&&f&&!l){g=f;
j=(f/k)>>0;}else{if(l&&k<=(f/i)){g=f;j=(f/k)>>0;}else{g=(i*k)>>0;j=i;}}}return{width:g,height:j};}},dataURLtoBlob:function(k){var f=k.split(",")[0].split(":")[1].split(";")[0];
var m=atob(k.split(",")[1]);var j=new ArrayBuffer(m.length);var g=new Uint8Array(j);for(var h=0;h<m.length;h++){g[h]=m.charCodeAt(h);}var l=(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder);
if(l){l=new (window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder)();l.append(j);return l.getBlob(f);}else{l=new Blob([j],{type:(f)});return l;
}},detectSubsampling:function(h){var g=h.width,j=h.height;if(g*j>1024*1024){var i=document.createElement("canvas");i.width=i.height=1;var f=i.getContext("2d");
f.drawImage(h,-g+1,0);return f.getImageData(0,0,1,1).data[3]===0;}else{return false;}},transformCoordinate:function(i,j,f,h){switch(h){case 5:case 6:case 7:case 8:i.width=f;
i.height=j;break;default:i.width=j;i.height=f;}var g=i.getContext("2d");switch(h){case 1:break;case 2:g.translate(j,0);g.scale(-1,1);break;case 3:g.translate(j,f);
g.rotate(Math.PI);break;case 4:g.translate(0,f);g.scale(1,-1);break;case 5:g.rotate(0.5*Math.PI);g.scale(1,-1);break;case 6:g.rotate(0.5*Math.PI);g.translate(0,-f);
break;case 7:g.rotate(0.5*Math.PI);g.translate(j,-f);g.scale(-1,1);break;case 8:g.rotate(-0.5*Math.PI);g.translate(-j,0);break;default:break;}},detectVerticalSquash:function(j,g,n){var f=document.createElement("canvas");
f.width=1;f.height=n;var o=f.getContext("2d");o.drawImage(j,0,0);var i=o.getImageData(0,0,1,n).data;var l=0;var k=n;var m=n;while(m>l){var h=i[(m-1)*4+3];
if(h===0){k=m;}else{l=m;}m=(k+l)>>1;}return m/n;},callback:function(f){return f;}},e={width:300,height:0,crop:false,quality:80,callback:a.callback};function b(g,f){this.file=g;
this.options=d.extend({},e,f);this._defaults=e;this._name=c;this.init();}b.prototype={init:function(){var h=this;var g=this.file;var f=new FileReader();
f.onloadend=function(k){var l=k.target.result;var i=new Image();var j=false;i.onload=function(m){d(i).exifLoadFromDataURL(function(){var p=d(i).exif("Orientation")[0];
var y=(p>=5&&p<=8)?a.newsize(i.height,i.width,h.options.width,h.options.height,h.options.crop):a.newsize(i.width,i.height,h.options.width,h.options.height,h.options.crop);
var r=i.width,w=i.height;var C=y.width,z=y.height;var o=document.createElement("canvas");var D=o.getContext("2d");D.save();a.transformCoordinate(o,C,z,p);
if(a.detectSubsampling(i)){r/=2;w/=2;}var G=1024;var n=document.createElement("canvas");n.width=n.height=G;var q=n.getContext("2d");var E=a.detectVerticalSquash(i,r,w);
var x=0;while(x<w){var H=x+G>w?w-x:G;var A=0;while(A<r){var B=A+G>r?r-A:G;q.clearRect(0,0,G,G);q.drawImage(i,-A,-x);var u=Math.floor(A*C/r);var v=Math.ceil(B*C/r);
var t=Math.floor(x*z/w/E);var F=Math.ceil(H*z/w/E);D.drawImage(n,0,0,B,H,u,t,v,F);A+=G;}x+=G;}D.restore();n=q=null;var s=document.createElement("canvas");
s.width=C;s.height=z;newctx=s.getContext("2d");newctx.drawImage(o,0,0,C,z);var I=s.toDataURL("image/jpeg",(h.options.quality*0.01));h.options.callback(I,C,z,j);
});};if(l&&l.match(/^data:base64/)){i.src=l.replace(/^data:base64/,"data:image/jpeg;base64");j=true;}else{i.src=l;}};f.readAsDataURL(g);}};d[c]=function(g,f){if(typeof g=="string"){return a[g](f);
}else{new b(g,f);}};})(jQuery);